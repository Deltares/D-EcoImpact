version: 0.0.0

input-data:
  - dataset:
      filename: ./tests_acceptance/input_nc_files/small_subset_FM-VZM_0000_map.nc
      variable_mapping:
        flow_velocity_ms: "flow_velocity"
        bathymetry_mNAP: "bathymetry"

rules:

  - formula_rule:
      name: Make sure that flow_velocity is only a positive value
      description: Make sure that flow_velocity is only a positive value
      formula: numpy.absolute(flow_velocity)
      input_variables:  [flow_velocity]
      output_variable: flow_velocity_abs
    
  - formula_rule:
      name: Make sure that bathymetry is not lower than 0
      description: Make sure that bathymetry is not lower than 0
      formula: numpy.where(bathymetry < 0, 0, bathymetry)
      input_variables:  [bathymetry]
      output_variable: bathymetry_cor
    
  - formula_rule:
      name: Estimate the shear flow velocity using the logarithmic law of the wall (add 0.001 to make sure log(0) does not occur
      description: Estimate the shear flow velocity using the logarithmic law of the wall (add 0.001 to make sure log(0) does not occur
      formula: (flow_velocity_abs * 0.41) / ( math.log((bathymetry_cor + 0.001 )/ 0.01)) 
      input_variables:  [flow_velocity_abs, bathymetry_cor]
      output_variable: shear_flow_velocity

output-data:
  filename: ./tests_acceptance/output_nc_files/10e_formula_based_use_of_safe_modules.nc
